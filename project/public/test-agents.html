<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Virtual Agents Test - Access Restricted</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-header {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-results {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .test-success {
            border-left-color: #28a745;
            background: #f8fff9;
        }
        .test-failure {
            border-left-color: #dc3545;
            background: #fff8f8;
        }
        .test-warning {
            border-left-color: #ffc107;
            background: #fffdf5;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pass { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
        .status.warn { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <!-- Admin Password Protection -->
    <div id="loginScreen" class="test-header" style="text-align: center;">
        <h1>üîí Admin Agent Testing Access</h1>
        <p>This page contains comprehensive agent testing functionality and requires admin authentication.</p>
        <div style="margin: 20px 0;">
            <input type="password" id="adminPassword" placeholder="Enter admin password" style="padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <button onclick="checkAdminPassword()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Access Agent Tests</button>
        </div>
        <div id="loginError" style="color: red; margin-top: 10px; display: none;">Invalid password. Access denied.</div>
    </div>

    <!-- Main content (hidden by default) -->
    <div id="mainContent" style="display: none;">
        <div class="test-header">
            <h1>üß™ Admin Virtual Agents Functionality Test</h1>
            <p>This test validates the complete virtual agents system functionality including agent orchestration, LLM integration, and message processing capabilities.</p>
            <button onclick="runComprehensiveTest()">Run Full Test Suite</button>
            <button onclick="runQuickTest()">Quick Validation</button>
        </div>

        <div id="results" class="test-results">
            <p>Click "Run Full Test Suite" to begin comprehensive virtual agents testing...</p>
        </div>
    </div>

    <script type="module">
        async function runComprehensiveTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>üîÑ Initializing comprehensive agent functionality test...</p>';

            try {
                // Import the test module
                const { AgentFunctionalityTester } = await import('/src/test/agents-functionality-test.ts');

                results.innerHTML += '<p>‚úÖ Successfully loaded agent functionality tester</p>';

                const tester = new AgentFunctionalityTester();
                results.innerHTML += '<p>üöÄ Running comprehensive test suite...</p>';

                const testResults = await tester.runComprehensiveTest();

                // Display results
                displayTestResults(testResults);

            } catch (error) {
                results.innerHTML += `<div class="test-section test-failure">
                    <h3>‚ùå Test Execution Failed</h3>
                    <p>Error: ${error.message}</p>
                    <pre>${error.stack}</pre>
                </div>`;
            }
        }

        async function runQuickTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>üîÑ Running quick validation test...</p>';

            try {
                // Quick module import test
                const { AdminAgentOrchestrator } = await import('/src/services/agents/refactored/AdminAgentOrchestrator.ts');
                results.innerHTML += '<p>‚úÖ AdminAgentOrchestrator loaded successfully</p>';

                const { agentBuilder } = await import('/src/services/agents/refactored/AgentBuilder.ts');
                results.innerHTML += '<p>‚úÖ AgentBuilder loaded successfully</p>';

                const { llmService } = await import('/src/services/agents/refactored/LLMService.ts');
                results.innerHTML += '<p>‚úÖ LLMService loaded successfully</p>';

                // Basic instantiation test
                const orchestrator = AdminAgentOrchestrator.getInstance();
                results.innerHTML += '<p>‚úÖ Agent orchestrator instantiated</p>';

                const templates = agentBuilder.getTemplates();
                results.innerHTML += `<p>‚úÖ Found ${templates.length} agent templates</p>`;

                results.innerHTML += `<div class="test-section test-success">
                    <h3>‚úÖ Quick Validation Complete</h3>
                    <p>All core agent modules loaded successfully. System appears operational.</p>
                    <p>Agent Templates Available: ${templates.map(t => t.name).join(', ')}</p>
                </div>`;

            } catch (error) {
                results.innerHTML += `<div class="test-section test-failure">
                    <h3>‚ùå Quick Validation Failed</h3>
                    <p>Error: ${error.message}</p>
                    <pre>${error.stack}</pre>
                </div>`;
            }
        }

        function displayTestResults(testResults) {
            const results = document.getElementById('results');

            let html = `<div class="test-section ${testResults.overallStatus === 'PASS' ? 'test-success' : testResults.overallStatus === 'FAIL' ? 'test-failure' : 'test-warning'}">
                <h3>${testResults.overallStatus === 'PASS' ? '‚úÖ' : testResults.overallStatus === 'FAIL' ? '‚ùå' : '‚ö†Ô∏è'} Overall Test Results</h3>
                <p><strong>Status:</strong> ${testResults.overallStatus}</p>
                <p><strong>Tests Passed:</strong> ${testResults.testsPassed}/${testResults.totalTests}</p>
                <p><strong>Execution Time:</strong> ${testResults.executionTime}ms</p>
                <p><strong>Summary:</strong> ${testResults.summary}</p>
            </div>`;

            testResults.testResults.forEach(test => {
                const status = test.status === 'PASS' ? 'test-success' : test.status === 'FAIL' ? 'test-failure' : 'test-warning';
                html += `<div class="test-section ${status}">
                    <h4><span class="status ${test.status.toLowerCase()}">${test.status}</span> ${test.testName}</h4>
                    <p>${test.description}</p>
                    <p><strong>Result:</strong> ${test.result}</p>
                    ${test.details ? `<details><summary>Show Details</summary><pre>${JSON.stringify(test.details, null, 2)}</pre></details>` : ''}
                    ${test.error ? `<p><strong>Error:</strong> ${test.error}</p>` : ''}
                </div>`;
            });

            results.innerHTML = html;
        }

        // Make functions global
        window.runComprehensiveTest = runComprehensiveTest;
        window.runQuickTest = runQuickTest;

        // Admin password check
        window.checkAdminPassword = function() {
            const password = document.getElementById('adminPassword').value;
            const adminPassword = 'meta3admin2024'; // Use environment variable in production

            if (password === adminPassword) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        };

        // Allow Enter key to submit password
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('adminPassword');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkAdminPassword();
                    }
                });
            }
        });
    </script>
</body>
</html>