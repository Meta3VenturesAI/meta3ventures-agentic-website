<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Agent System Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result-box {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            min-height: 100px;
        }
        .status-pass { color: #28a745; font-weight: bold; }
        .status-fail { color: #dc3545; font-weight: bold; }
        .status-pending { color: #ffc107; font-weight: bold; }
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .agent-card {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Admin Password Protection -->
    <div id="loginScreen" class="test-container" style="text-align: center;">
        <h1>🔒 Admin Agent System Access</h1>
        <p>This page contains agent testing functionality and requires admin authentication.</p>
        <div style="margin: 20px 0;">
            <input type="password" id="adminPassword" placeholder="Enter admin password" style="padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <button class="test-button" onclick="checkAdminPassword()">Access Agent Tests</button>
        </div>
        <div id="loginError" style="color: red; margin-top: 10px; display: none;">Invalid password. Access denied.</div>
    </div>

    <!-- Main content (hidden by default) -->
    <div id="mainContent" style="display: none;">
        <h1>🤖 Admin Agent System Test</h1>

        <div class="test-container">
            <h2>Test Status</h2>
            <div id="overallStatus" class="status-pending">⏳ Ready to test</div>
            <p>Click the buttons below to test individual agents or run comprehensive tests.</p>
        </div>

    <div class="test-container">
        <h2>Quick Agent Tests</h2>
        <button class="test-button" onclick="testAgent('meta3-primary', 'Tell me about Meta3Ventures')">Test Meta3 Primary</button>
        <button class="test-button" onclick="testAgent('venture-launch', 'I need help with my startup business plan')">Test Venture Launch</button>
        <button class="test-button" onclick="testAgent('meta3-investment', 'What are your investment criteria?')">Test Investment</button>
        <button class="test-button" onclick="testAgent('meta3-research', 'Analyze the AI market trends')">Test Research</button>
        <button class="test-button" onclick="testAllAgents()">Test All Agents</button>
        <button class="test-button" onclick="clearResults()">Clear Results</button>
    </div>

    <div class="result-box">
        <h3>Test Results</h3>
        <div id="testResults">No tests run yet. Click a test button above.</div>
    </div>

    <div class="agents-grid">
        <div class="agent-card">
            <h3>🏢 Meta3 Primary Agent</h3>
            <p>Company information, navigation, general guidance</p>
            <button class="test-button" onclick="testAgent('meta3-primary', 'What services does Meta3 offer?')">Test Services Query</button>
            <button class="test-button" onclick="testAgent('meta3-primary', 'How do I contact Meta3?')">Test Contact Query</button>
        </div>

        <div class="agent-card">
            <h3>🚀 Venture Launch Builder</h3>
            <p>Business planning, MVP development, market validation</p>
            <button class="test-button" onclick="testAgent('venture-launch', 'Create a business plan for an AI startup')">Test Business Plan</button>
            <button class="test-button" onclick="testAgent('venture-launch', 'Help me validate my product idea')">Test MVP Guidance</button>
        </div>

        <div class="agent-card">
            <h3>💰 Investment Specialist</h3>
            <p>Funding guidance, investment analysis</p>
            <button class="test-button" onclick="testAgent('meta3-investment', 'What funding options are available?')">Test Funding Query</button>
            <button class="test-button" onclick="testAgent('meta3-investment', 'Analyze this investment opportunity')">Test Analysis</button>
        </div>

        <div class="agent-card">
            <h3>📊 Research Specialist</h3>
            <p>Market research, competitive analysis</p>
            <button class="test-button" onclick="testAgent('meta3-research', 'Research the fintech market size')">Test Market Research</button>
            <button class="test-button" onclick="testAgent('meta3-research', 'Competitive analysis of AI companies')">Test Competitive Analysis</button>
        </div>
    </div>

    <script type="module">
        let testResults = [];

        // Test individual agent
        window.testAgent = async function(preferredAgent, message) {
            const startTime = Date.now();
            updateStatus('🔄 Testing agent: ' + preferredAgent);

            try {
                // Import the agent orchestrator
                const { adminAgentOrchestrator } = await import('/src/services/agents/refactored/AdminAgentOrchestrator.ts');

                // Create test context
                const context = {
                    sessionId: `test-${Date.now()}`,
                    userId: 'test-user',
                    timestamp: new Date(),
                    metadata: {
                        source: 'manual-test',
                        preferredAgent: preferredAgent
                    }
                };

                // Process message
                const response = await adminAgentOrchestrator.processMessage(message, context);
                const duration = Date.now() - startTime;

                const result = {
                    agent: preferredAgent,
                    message: message,
                    response: response.content,
                    duration: duration,
                    success: true,
                    agentId: response.agentId || 'unknown'
                };

                testResults.push(result);
                displayResult(result);
                updateStatus(`✅ Test completed in ${duration}ms`);

            } catch (error) {
                const duration = Date.now() - startTime;
                const result = {
                    agent: preferredAgent,
                    message: message,
                    response: `ERROR: ${error.message}`,
                    duration: duration,
                    success: false,
                    error: error.message
                };

                testResults.push(result);
                displayResult(result);
                updateStatus(`❌ Test failed: ${error.message}`);
            }
        };

        // Test all agents
        window.testAllAgents = async function() {
            updateStatus('🔄 Running comprehensive agent tests...');
            const testCases = [
                ['meta3-primary', 'Tell me about Meta3Ventures'],
                ['venture-launch', 'I need help with my startup business plan'],
                ['meta3-investment', 'What are your investment criteria?'],
                ['meta3-research', 'Analyze the AI market trends'],
                ['general-conversation', 'Hello, how can you help me?']
            ];

            for (const [agent, message] of testCases) {
                await testAgent(agent, message);
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }

            const passed = testResults.filter(r => r.success).length;
            const total = testResults.length;
            updateStatus(`📊 Comprehensive test completed: ${passed}/${total} passed`);
        };

        // Clear results
        window.clearResults = function() {
            testResults = [];
            document.getElementById('testResults').innerHTML = 'Results cleared. Ready for new tests.';
            updateStatus('🔄 Ready to test');
        };

        // Display result
        function displayResult(result) {
            const resultsDiv = document.getElementById('testResults');
            const statusClass = result.success ? 'status-pass' : 'status-fail';
            const statusIcon = result.success ? '✅' : '❌';

            const resultHtml = `
                <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 6px;">
                    <div class="${statusClass}">
                        ${statusIcon} Agent: ${result.agent} (${result.duration}ms)
                        ${result.agentId ? `- Handled by: ${result.agentId}` : ''}
                    </div>
                    <div><strong>Query:</strong> ${result.message}</div>
                    <div style="margin-top: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                        <strong>Response:</strong><br>
                        ${result.response.substring(0, 500)}${result.response.length > 500 ? '...' : ''}
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;
        }

        // Update status
        function updateStatus(message) {
            document.getElementById('overallStatus').innerHTML = message;
        }

        // Admin password check
        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            const adminPassword = 'meta3admin2024'; // Use environment variable in production

            if (password === adminPassword) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                updateStatus('🤖 Agent test system ready. Click buttons to test individual agents.');
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        }

        // Allow Enter key to submit password
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('adminPassword');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkAdminPassword();
                    }
                });
            }
        });
    </script>

    </div> <!-- Close mainContent div -->

</body>
</html>