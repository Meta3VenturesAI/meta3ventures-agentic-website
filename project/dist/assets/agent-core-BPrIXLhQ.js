var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{M as s,b as a,V as i,C as n,G as r,c as o,d as l,f as c,g,h as d,i as u,j as m,p}from"./agent-utils-CXuTC0dg.js";import{a as h}from"./agent-tools-QezIHBTH.js";import{l as v}from"./agent-llm-0c-ni-C7.js";const y=new class{constructor(){t(this,"sessions",new Map),t(this,"agents",new Map),t(this,"stats"),t(this,"conversationState",new Map),this.initializeAgents(),this.initializeStats()}initializeAgents(){const e=new s,t=new a,m=new i,p=new n,h=new r,v=new o,y=new l,b=new c,f=new g,C=new d,w=new u;this.agents.set(e.getCapabilities().id,e),this.agents.set(t.getCapabilities().id,t),this.agents.set(m.getCapabilities().id,m),this.agents.set(p.getCapabilities().id,p),this.agents.set(h.getCapabilities().id,h),this.agents.set(v.getCapabilities().id,v),this.agents.set(y.getCapabilities().id,y),this.agents.set(b.getCapabilities().id,b),this.agents.set(f.getCapabilities().id,f),this.agents.set(C.getCapabilities().id,C),this.agents.set(w.getCapabilities().id,w)}initializeStats(){this.stats={totalSessions:0,activeSessions:0,totalMessages:0,agentUsage:{},averageResponseTime:0,systemHealth:"healthy"}}async processMessage(e,t="admin-user",s){const a="string"==typeof t?{sessionId:s||this.generateSessionId(),userId:t,metadata:{}}:t,i=a.sessionId,n=m.getOrCreateSession(a.userId||"anonymous",i);m.addMessage(n.id,{id:`msg-${Date.now()}`,content:e,role:"user",timestamp:new Date});const r=m.getSessionContext(n.id);let o=this.sessions.get(i);o||(o=this.createSession(i,a.userId||"anonymous"),this.sessions.set(i,o));let l=this.conversationState.get(i);l||(l=this.createConversationState(i,a.userId||"anonymous"),this.conversationState.set(i,l));const c=this.normalizeMessage(e),g=l.repeatedQueries.get(c)||0,d=g>0;l.repeatedQueries.set(c,g+1);const u=this.selectAgent(e,l),p={sessionId:i,userId:a.userId,conversationHistory:r.recentMessages.map(e=>({id:e.id,role:e.role,content:e.content,timestamp:e.timestamp,agentId:e.agentId||"system"})),currentAgent:u.getCapabilities().id,timestamp:new Date,metadata:{isRepeatedQuery:d,repetitionCount:g,conversationStage:l.conversationStage,preferredResponseStyle:l.preferredResponseStyle,userProfile:r.userProfile,keyTopics:r.keyTopics,conversationSummary:r.conversationSummary,availableTools:h.getToolsForAgent(u.getCapabilities().id),...a.metadata}},v=Date.now(),y=await u.processMessage(e,p),b=Date.now()-v;return this.updateConversationState(l,e,y,u.getCapabilities().id),m.addMessage(n.id,{id:`msg-${Date.now()}-response`,content:y.content,role:"assistant",timestamp:new Date,agentId:u.getCapabilities().id,metadata:{processingTime:b,toolsUsed:y.metadata?.toolsUsed||[]}}),this.updateStats(u.getCapabilities().id,b),o.lastActivity=new Date,o.messageCount++,o.currentAgent=u.getCapabilities().id,o.context.conversationHistory||(o.context.conversationHistory=[]),o.context.conversationHistory.push({id:this.generateSessionId(),role:"user",content:e,timestamp:new Date,agentId:"user"}),o.context.conversationHistory.push(y),y}selectAgent(e,t){let s=null;const a=Array.from(this.agents.values()).map(s=>{const a=s.canHandle(e),i=s.getCapabilities();let n=0;if(a){n=i.priority;const s=e.toLowerCase().split(/\s+/);n+=10*i.specialties.filter(e=>s.some(t=>e.toLowerCase().includes(t)||t.length>3&&e.toLowerCase().includes(t))).length,t?.lastAgentUsed===i.id&&(n+=15),(e.toLowerCase().includes(i.name.toLowerCase())||i.specialties.some(t=>e.toLowerCase().includes(t.toLowerCase())))&&(n+=25);n+=20*({"venture-launch":["startup","business plan","mvp","venture","founder"],"meta3-primary":["meta3","about","company","ai","platform"],"general-conversation":["hello","hi","help","general"]}[i.id]||[]).filter(t=>e.toLowerCase().includes(t)).length}return{agent:s,score:n,canHandle:a}}).filter(e=>e.canHandle).sort((e,t)=>t.score-e.score)[0];if(a)s=a.agent;else{s=this.agents.get("meta3-primary")||Array.from(this.agents.values())[0]}return s}createSession(e,t){const s=new Date;return{sessionId:e,userId:t,currentAgent:"meta3-primary",startTime:s,lastActivity:s,messageCount:0,context:{sessionId:e,userId:t,conversationHistory:[],currentAgent:"meta3-primary",timestamp:s},isActive:!0}}updateStats(e,t){this.stats.totalMessages++,this.stats.agentUsage[e]=(this.stats.agentUsage[e]||0)+1;const s=this.stats.averageResponseTime*(this.stats.totalMessages-1);this.stats.averageResponseTime=(s+t)/this.stats.totalMessages}generateSessionId(){return`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getSystemStats(){return this.stats.activeSessions=Array.from(this.sessions.values()).filter(e=>e.isActive&&Date.now()-e.lastActivity.getTime()<18e5).length,{...this.stats}}getAgentList(){return Array.from(this.agents.values()).map(e=>{const t=e.getCapabilities();return{id:t.id,name:t.name,specialties:t.specialties}})}async performSystemDiagnostics(){return{orchestrator:{status:"operational",message:`${this.agents.size} agents loaded and ready`},agents:Array.from(this.agents.values()).map(e=>({id:e.getCapabilities().id,status:"ready",health:"good"})),llmProviders:[{id:"internal",status:"ready",available:!0}],performance:{cpu:30*Math.random()+20,memory:40*Math.random()+30,responseTime:this.stats.averageResponseTime}}}async getLLMProviders(){try{return(await p.detectAvailableProviders()).map(e=>({id:e.id,name:e.name,available:e.available,models:"fallback"===e.id?["fallback-agent"]:this.getModelsForProvider(e.id),latency:e.latency}))}catch(e){return[{id:"fallback",name:"Fallback Agent",available:!0,models:["fallback-agent"],latency:50}]}}getModelsForProvider(e){return{ollama:["llama3.2:3b","llama3.2:1b","mistral:7b"],vllm:["mistral-7b-instruct","llama2-7b-chat"],localai:["gpt-3.5-turbo","llama2-chat"],groq:["llama3-8b-8192","mixtral-8x7b-32768"],openai:["gpt-4","gpt-3.5-turbo"],anthropic:["claude-3-sonnet","claude-3-haiku"],deepseek:["deepseek-chat","deepseek-coder"],fallback:["fallback-agent"]}[e]||["default-model"]}async testLLMProvider(e){try{const t=await v.testConnection(e);return{success:t.success,error:t.error,latency:t.latency||0}}catch(t){return{success:!1,error:t.message,latency:0}}}getDeepAgentStats(){return{totalAgents:this.agents.size,activeAgents:this.agents.size,completedTasks:this.stats.totalMessages,averagePerformance:Math.min(this.stats.averageResponseTime/1e3,5)}}configureAgent(e,t){const s=this.agents.get(e);if(!s)return!1;try{return s.configureLLM(t),!0}catch(a){return!1}}getAgentConfiguration(e){const t=this.agents.get(e);return t?t.getLLMConfiguration():null}getAllAgentConfigurations(){const e=[];for(const[t,s]of this.agents.entries()){const a=s.getLLMConfiguration(),i=s.getCapabilities();e.push({id:t,name:i.name,...a})}return e}async testAgentLLM(e,t="Hello, this is a test message."){const s=this.agents.get(e);if(!s)return{success:!1,error:`Agent ${e} not found`,processingTime:0};const a=Date.now();try{const i={sessionId:"test-session",userId:"test-user",conversationHistory:[],currentAgent:e,timestamp:new Date},n=await s.processMessage(t,i),r=Date.now()-a;return{success:!0,response:n.content,processingTime:r}}catch(i){return{success:!1,error:i.message,processingTime:Date.now()-a}}}createConversationState(e,t){return{sessionId:e,userId:t,topicsCovered:[],conversationStage:"greeting",preferredResponseStyle:"brief",repeatedQueries:new Map}}normalizeMessage(e){return e.toLowerCase().trim().replace(/[?.!,]/g,"")}updateConversationState(e,t,s,a){const i=t.toLowerCase();i.includes("about")&&(e.topicsCovered.includes("about")||e.topicsCovered.push("about"),e.lastAboutQuery=new Date),(i.includes("hello")||i.includes("hi"))&&(e.lastGreeting=new Date),i.includes("investment")||i.includes("funding")?e.conversationStage="specialized":i.includes("apply")||i.includes("contact")?e.conversationStage="action":e.topicsCovered.length>0&&(e.conversationStage="information"),e.lastAgentUsed=a,s.content&&s.content.length>300&&(e.preferredResponseStyle="detailed")}};export{y as a};
